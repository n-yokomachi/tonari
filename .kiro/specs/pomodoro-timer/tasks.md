# Implementation Plan

- [ ] 1. ポモドーロタイマーの状態管理ストアを作成する
- [ ] 1.1 タイマーの状態と設定を管理するZustandストアを新規作成する
  - タイマーのフェーズ（idle, work, break, paused, completed）、残り時間、実行状態、完了セッション数を管理する
  - 作業時間（デフォルト25分）、休憩時間（デフォルト5分）、目標セッション数（デフォルト4）、自動開始（デフォルトON）の設定値を管理する
  - paused時に元のフェーズを保持し、resume時に復元できるようにする
  - _Requirements: 1.4, 3.3, 5.6_
  - _Contracts: PomodoroState_

- [ ] 1.2 タイマー操作メソッドとフェーズ遷移ロジックを実装する
  - start: idleから作業フェーズに遷移しカウントダウンを開始する
  - pause/resume: 一時停止と再開で残り時間を保持する
  - skip: 現在のフェーズを飛ばして次のフェーズ（作業→休憩、休憩→作業）に遷移する
  - stop: すべての状態をリセットしidleに戻る
  - tick: 残り時間を1秒デクリメントし、0到達時にフェーズ遷移を実行する
  - 作業セッション完了時にセッションカウントをインクリメントし、目標達成時にcompleted状態にする
  - フェーズ遷移時、自動開始がOFFならタイマーを一時停止状態にする
  - _Requirements: 1.1, 1.2, 1.3, 1.5, 2.1, 2.2, 2.3, 2.4, 3.1, 3.2, 4.3, 4.4_
  - _Contracts: PomodoroActions_

- [ ] 1.3 設定値のlocalStorage永続化を実装する
  - Zustand persistミドルウェアで設定値（作業時間、休憩時間、目標セッション数、自動開始）のみを永続化する
  - アプリ起動時にlocalStorageから設定を読み込み、存在しない場合はデフォルト値を使用する
  - 設定変更メソッドで値のバリデーション（最小値チェック）を行い、即座にlocalStorageに保存する
  - _Requirements: 5.1, 5.2, 5.3, 5.4, 5.5, 5.6_

- [ ] 2. タイマーアイコンを追加しメニューに統合する
- [ ] 2.1 (P) タイマー用SVGアイコンを作成しアイコンシステムに登録する
  - 24x24のタイマーSVGアイコンを作成する
  - アイコンボタンのマッピングにタイマーアイコンを追加する
  - _Requirements: 7.1_

- [ ] 2.2 デスクトップメニューとモバイルヘッダーにタイマー起動ボタンを追加する
  - デスクトップメニューのコントロールパネルにタイマー起動アイコンボタンを追加する
  - モバイルヘッダーのナビゲーションにタイマー起動アイコンボタンを追加する
  - ボタンクリック時にポモドーロタイマーを開始する
  - _Requirements: 7.1, 7.2_

- [ ] 3. 円形プログレスUIコンポーネントを作成する
- [ ] 3.1 (P) SVGベースの円形プログレスインジケーターコンポーネントを作成する
  - 進捗率（0〜1）に応じてSVGの円が埋まっていくアニメーションを実装する
  - 円の中心にchildren要素（デジタルタイマー表示）をレンダリングできるようにする
  - サイズ、線幅、色、背景色をプロパティで制御可能にする
  - CSSトランジションでスムーズなプログレスアニメーションを実現する
  - _Requirements: 6.1, 6.2, 6.3_
  - _Contracts: CircularProgressProps_

- [ ] 4. タイマーUIコンポーネントを作成する
- [ ] 4.1 タイマー表示、操作ボタン、セッションカウントを含む統合UIコンポーネントを作成する
  - 円形プログレスの中心に「分:秒」形式で残り時間を表示する
  - 作業フェーズと休憩フェーズで色を切り替える（作業: 赤系、休憩: 緑系）
  - 一時停止/再開（トグル）、スキップ、停止の操作ボタンを配置する
  - 完了セッション数と目標セッション数を ● ● ○ ○ 形式で視覚的に表示する
  - 目標セッション達成時に完了状態のUIを表示する
  - UIの大部分を半透過にしてVRMアバターが背後に見えるようにする
  - idleフェーズのとき非表示にする
  - 独立コンポーネントとして実装し、表示位置の変更が容易にできるようにする
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 4.1, 4.2, 4.3, 6.3, 6.4, 6.5, 7.3, 7.4, 7.5_

- [ ] 4.2 設定変更UIを作成する
  - 作業時間、休憩時間を分単位で入力できるフォームを作成する
  - 目標セッション回数の入力フィールドを作成する
  - 自動開始のオン/オフトグルを作成する
  - タイマー動作中は設定変更を無効化する
  - タイマーUIコンポーネント内のギアアイコンから開閉できるようにする
  - _Requirements: 5.1, 5.2, 5.3_

- [ ] 5. タイマーカウントダウンフックを作成する
- [ ] 5.1 1秒間隔のインターバルでタイマーを駆動するフックを作成する
  - setIntervalで1秒ごとにストアのtickメソッドを呼び出す
  - タイマーの実行状態に応じてインターバルの開始と停止を管理する
  - ブラウザタブが非アクティブから復帰した際に経過時間を計算し残り時間を補正する
  - コンポーネントアンマウント時にインターバルをクリーンアップする
  - _Requirements: 1.1, 1.5_
  - _Contracts: usePomodoroTimer_

- [ ] 6. ページ統合とタイマーUIの配置を行う
- [ ] 6.1 メインページにタイマーフックとUIコンポーネントを統合する
  - メインページでタイマーカウントダウンフックを呼び出す
  - タイマーUIコンポーネントを画面右上にオーバーレイ配置する
  - デスクトップとモバイル/縦画面の両方で正しく表示されることを確認する
  - _Requirements: 7.2, 7.4_

- [ ] 7. 睡眠モード連携を実装する
- [ ] 7.1 作業セッション中に睡眠モードを抑制する
  - 睡眠チェックの条件にポモドーロタイマーの作業フェーズ状態を追加する
  - 作業フェーズ中は睡眠チェックをスキップし、アバターを起きた状態に保つ
  - 休憩フェーズ中やタイマー停止後は通常通り睡眠チェックを実行する
  - _Requirements: 8.1, 8.2, 8.3_

- [ ] 8. 作業中モーション再生フックを作成する
- [ ] 8.1 作業セッション中に専用モーションをランダム再生するフックを作成する
  - 作業フェーズ中にランダムな間隔（60〜180秒）で作業専用モーションを再生する
  - 作業専用モーションセットとして複数のジェスチャーを定義する（ガッツポーズ、読書など）
  - 休憩フェーズやタイマー停止時にモーション再生を停止し通常の待機モーションに戻す
  - _Requirements: 9.1, 9.2, 9.3_
  - _Contracts: usePomodoroMotion_

- [ ] 8.2 作業中のアイドルモーション抑制を実装する
  - 既存のアイドルモーションフックにポモドーロ作業フェーズのチェックを追加する
  - 作業フェーズ中は通常のアイドルモーション（首かしげ、考え込みなど）の再生をスキップする
  - メインページでポモドーロモーションフックを呼び出す
  - _Requirements: 9.1, 9.2_

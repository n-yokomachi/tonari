# Phase 4: UI/UX改善

## 目的

Scenseiのユーザー体験を向上させるため、レスポンシブ対応、ローディング表示、エラーハンドリングなどのUI/UX改善を行う。

## 完了条件

- [ ] レスポンシブ対応（モバイル/タブレット/デスクトップ）
- [ ] ローディング表示の改善（AI応答待ち時のフィードバック）
- [ ] エラーハンドリングの改善（ユーザーフレンドリーなエラーメッセージ）
- [ ] 入力フォームの使いやすさ改善
- [ ] アクセシビリティの基本対応

## 現状の課題

### レイアウト

- 現在のグリッドレイアウト（`gridTemplateColumns: '800px 1fr'`）は固定幅
- モバイル端末では横スクロールが発生する可能性
- VRMビューワーとチャットUIのバランス調整が必要

### ローディング/フィードバック

- AI応答待ち時のユーザーフィードバックが不十分
- リップシンク中の状態表示

### エラー処理

- API エラー時のユーザーへの通知
- ネットワークエラー時のリトライ機能

## 実装タスク

### 1. レスポンシブ対応

#### ブレークポイント定義

```css
/* モバイル: ~767px */
/* タブレット: 768px~1023px */
/* デスクトップ: 1024px~ */
```

#### レイアウト変更案

**デスクトップ（現状維持）**
```
┌─────────────┬─────────────┐
│  チャットUI  │  VRMビューワー │
├─────────────┴─────────────┤
│         入力欄            │
└───────────────────────────┘
```

**モバイル/タブレット**
```
┌───────────────────────────┐
│       VRMビューワー        │
├───────────────────────────┤
│        チャットUI          │
├───────────────────────────┤
│          入力欄           │
└───────────────────────────┘
```

#### 実装箇所

- `src/pages/index.tsx` - グリッドレイアウトの条件分岐
- Tailwind CSSのレスポンシブクラス活用

### 2. ローディング表示

#### AI応答待ち

- 「考え中...」のアニメーション表示
- VRMキャラクターの「考え中」表情連動
- 入力欄の無効化（二重送信防止）

#### 実装箇所

- `src/components/chatLog.tsx` - ローディングインジケーター追加
- `src/features/stores/home.ts` - `chatProcessing`状態の活用

### 3. エラーハンドリング

#### エラーパターン

| エラー種別 | 表示内容 | アクション |
|-----------|---------|----------|
| APIキー未設定 | 「APIキーを設定してください」 | 設定画面へ誘導 |
| ネットワークエラー | 「接続エラーが発生しました」 | リトライボタン |
| レート制限 | 「しばらく待ってから再度お試しください」 | 待機時間表示 |
| 一般エラー | 「エラーが発生しました」 | 詳細ログ |

#### 実装箇所

- `src/features/chat/handlers.ts` - エラーキャッチ強化
- `src/components/toasts.tsx` - エラートースト表示

### 4. 入力フォーム改善

- Enter送信 / Shift+Enter改行
- 入力中のリアルタイム文字数カウント
- 送信ボタンの状態表示（disabled時のスタイル）
- プリセットボタンの使いやすさ改善

### 5. アクセシビリティ

- キーボードナビゲーション対応
- スクリーンリーダー対応（aria-label）
- フォーカス可視化
- カラーコントラスト確認

## テスト項目

### レスポンシブ

- [ ] iPhone SE（375px）で正常表示
- [ ] iPad（768px）で正常表示
- [ ] デスクトップ（1024px以上）で正常表示
- [ ] 画面回転時にレイアウトが崩れない

### ローディング

- [ ] AI応答待ち中にローディング表示される
- [ ] ローディング中は入力欄が無効化される
- [ ] 応答完了後にローディングが消える

### エラー

- [ ] APIキー未設定時に適切なエラー表示
- [ ] ネットワークエラー時にトースト表示
- [ ] エラー後も正常に操作を継続できる

### アクセシビリティ

- [ ] Tabキーでフォーカス移動できる
- [ ] フォーカス状態が視覚的にわかる
- [ ] Enterキーで送信できる

## 技術的な詳細

### Tailwind CSSレスポンシブ

```tsx
// 例: モバイルで縦並び、デスクトップで横並び
<div className="flex flex-col md:flex-row">
  {/* ... */}
</div>
```

### useMediaQuery Hook（必要に応じて）

```typescript
const useMediaQuery = (query: string) => {
  const [matches, setMatches] = useState(false)

  useEffect(() => {
    const media = window.matchMedia(query)
    setMatches(media.matches)

    const listener = (e: MediaQueryListEvent) => setMatches(e.matches)
    media.addEventListener('change', listener)
    return () => media.removeEventListener('change', listener)
  }, [query])

  return matches
}

// 使用例
const isMobile = useMediaQuery('(max-width: 767px)')
```

## 優先度

1. **高**: レスポンシブ対応（モバイルユーザーの使用を可能に）
2. **高**: ローディング表示（ユーザーフィードバック必須）
3. **中**: エラーハンドリング（UX向上）
4. **中**: 入力フォーム改善（使いやすさ向上）
5. **低**: アクセシビリティ（将来的な対応）

## 備考

- Phase 1-3で構築した基盤の上にUI/UX改善を行う
- 大きなリファクタリングは避け、既存コードへの追加・修正で対応
- パフォーマンスへの影響に注意（特にモバイル端末）
